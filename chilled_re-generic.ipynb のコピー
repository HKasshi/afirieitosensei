{"cells":[{"cell_type":"code","execution_count":5,"metadata":{"id":"sBbcB4vwj_jm","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1681826713409,"user_tz":-540,"elapsed":72630,"user":{"displayName":"張本勝史","userId":"04120476785478321714"}},"outputId":"947455b8-257c-4ee9-e6b2-c90523332c58"},"outputs":[{"output_type":"stream","name":"stdout","text":["  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n","                                 Dload  Upload   Total   Spent    Left  Speed\n","\r  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0\r  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0\n","\r100  761k  100  761k    0     0  7690k      0 --:--:-- --:--:-- --:--:-- 7690k\n","unzip:  cannot find or open /content/memfix.zip, /content/memfix.zip.zip or /content/memfix.zip.ZIP.\n","libunwind-dev is already the newest version (1.2.1-9ubuntu0.1).\n","0 upgraded, 0 newly installed, 0 to remove and 28 not upgraded.\n","\u001b[1mdpkg:\u001b[0m \u001b[1;31merror:\u001b[0m cannot access archive '*.deb': No such file or directory\n","env: LD_PRELOAD=libtcmalloc.so\n","rm: cannot remove 'configs': Is a directory\n","rm: cannot remove 'detected_maps': Is a directory\n","rm: cannot remove 'embeddings': Is a directory\n","rm: cannot remove 'extensions': Is a directory\n","rm: cannot remove 'extensions-builtin': Is a directory\n","rm: cannot remove 'html': Is a directory\n","rm: cannot remove 'javascript': Is a directory\n","rm: cannot remove 'localizations': Is a directory\n","rm: cannot remove 'log': Is a directory\n","rm: cannot remove 'models': Is a directory\n","rm: cannot remove 'modules': Is a directory\n","rm: cannot remove 'outputs': Is a directory\n","rm: cannot remove '__pycache__': Is a directory\n","rm: cannot remove 'repositories': Is a directory\n","rm: cannot remove 'scripts': Is a directory\n","rm: cannot remove 'stable-diffusion-webui': Is a directory\n","rm: cannot remove 'test': Is a directory\n","rm: cannot remove 'textual_inversion_templates': Is a directory\n","Looking in indexes: https://pypi.org/simple, https://us-python.pkg.dev/colab-wheels/public/simple/\n","Requirement already satisfied: fastapi==0.90.1 in /usr/local/lib/python3.9/dist-packages (0.90.1)\n","Requirement already satisfied: pydantic!=1.7,!=1.7.1,!=1.7.2,!=1.7.3,!=1.8,!=1.8.1,<2.0.0,>=1.6.2 in /usr/local/lib/python3.9/dist-packages (from fastapi==0.90.1) (1.10.7)\n","Requirement already satisfied: starlette<0.24.0,>=0.22.0 in /usr/local/lib/python3.9/dist-packages (from fastapi==0.90.1) (0.23.1)\n","Requirement already satisfied: typing-extensions>=4.2.0 in /usr/local/lib/python3.9/dist-packages (from pydantic!=1.7,!=1.7.1,!=1.7.2,!=1.7.3,!=1.8,!=1.8.1,<2.0.0,>=1.6.2->fastapi==0.90.1) (4.5.0)\n","Requirement already satisfied: anyio<5,>=3.4.0 in /usr/local/lib/python3.9/dist-packages (from starlette<0.24.0,>=0.22.0->fastapi==0.90.1) (3.6.2)\n","Requirement already satisfied: sniffio>=1.1 in /usr/local/lib/python3.9/dist-packages (from anyio<5,>=3.4.0->starlette<0.24.0,>=0.22.0->fastapi==0.90.1) (1.3.0)\n","Requirement already satisfied: idna>=2.8 in /usr/local/lib/python3.9/dist-packages (from anyio<5,>=3.4.0->starlette<0.24.0,>=0.22.0->fastapi==0.90.1) (3.4)\n","Looking in indexes: https://pypi.org/simple, https://us-python.pkg.dev/colab-wheels/public/simple/, https://download.pytorch.org/whl/cu116\n","Requirement already satisfied: torch==1.13.1+cu116 in /usr/local/lib/python3.9/dist-packages (1.13.1+cu116)\n","Requirement already satisfied: torchvision==0.14.1+cu116 in /usr/local/lib/python3.9/dist-packages (0.14.1+cu116)\n","Requirement already satisfied: torchaudio==0.13.1 in /usr/local/lib/python3.9/dist-packages (0.13.1+cu116)\n","Requirement already satisfied: torchtext==0.14.1 in /usr/local/lib/python3.9/dist-packages (0.14.1)\n","Requirement already satisfied: torchdata==0.5.1 in /usr/local/lib/python3.9/dist-packages (0.5.1)\n","Requirement already satisfied: typing-extensions in /usr/local/lib/python3.9/dist-packages (from torch==1.13.1+cu116) (4.5.0)\n","Requirement already satisfied: requests in /usr/local/lib/python3.9/dist-packages (from torchvision==0.14.1+cu116) (2.27.1)\n","Requirement already satisfied: pillow!=8.3.*,>=5.3.0 in /usr/local/lib/python3.9/dist-packages (from torchvision==0.14.1+cu116) (9.5.0)\n","Requirement already satisfied: numpy in /usr/local/lib/python3.9/dist-packages (from torchvision==0.14.1+cu116) (1.22.4)\n","Requirement already satisfied: tqdm in /usr/local/lib/python3.9/dist-packages (from torchtext==0.14.1) (4.65.0)\n","Requirement already satisfied: urllib3>=1.25 in /usr/local/lib/python3.9/dist-packages (from torchdata==0.5.1) (1.26.15)\n","Requirement already satisfied: portalocker>=2.0.0 in /usr/local/lib/python3.9/dist-packages (from torchdata==0.5.1) (2.7.0)\n","Requirement already satisfied: certifi>=2017.4.17 in /usr/local/lib/python3.9/dist-packages (from requests->torchvision==0.14.1+cu116) (2022.12.7)\n","Requirement already satisfied: idna<4,>=2.5 in /usr/local/lib/python3.9/dist-packages (from requests->torchvision==0.14.1+cu116) (3.4)\n","Requirement already satisfied: charset-normalizer~=2.0.0 in /usr/local/lib/python3.9/dist-packages (from requests->torchvision==0.14.1+cu116) (2.0.12)\n","fatal: destination path 'stable-diffusion-webui' already exists and is not an empty directory.\n","fatal: destination path '/content/stable-diffusion-webui/extensions/sd-webui-tunnels' already exists and is not an empty directory.\n","fatal: destination path '/content/stable-diffusion-webui/extensions/sd-webui-controlnet' already exists and is not an empty directory.\n","fatal: destination path '/content/stable-diffusion-webui/extensions/posex' already exists and is not an empty directory.\n","fatal: destination path '/content/stable-diffusion-webui/extensions/stable-diffusion-webui-images-browser' already exists and is not an empty directory.\n","  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n","                                 Dload  Upload   Total   Spent    Left  Speed\n","100  1155  100  1155    0     0  10312      0 --:--:-- --:--:-- --:--:-- 10312\n","100 3832M  100 3832M    0     0   230M      0  0:00:16  0:00:16 --:--:--  203M\n","  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n","                                 Dload  Upload   Total   Spent    Left  Speed\n","100  1157  100  1157    0     0  11570      0 --:--:-- --:--:-- --:--:-- 11570\n","100  689M  100  689M    0     0   235M      0  0:00:02  0:00:02 --:--:--  256M\n","  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n","                                 Dload  Upload   Total   Spent    Left  Speed\n","100  1155  100  1155    0     0   9166      0 --:--:-- --:--:-- --:--:--  9166\n","100  689M  100  689M    0     0   256M      0  0:00:02  0:00:02 --:--:--  275M\n","  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n","                                 Dload  Upload   Total   Spent    Left  Speed\n","100  1147  100  1147    0     0  10522      0 --:--:-- --:--:-- --:--:-- 10522\n","100  689M  100  689M    0     0   223M      0  0:00:03  0:00:03 --:--:--  269M\n","  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n","                                 Dload  Upload   Total   Spent    Left  Speed\n","100  1151  100  1151    0     0  11284      0 --:--:-- --:--:-- --:--:-- 11284\n","100  689M  100  689M    0     0   210M      0  0:00:03  0:00:03 --:--:--  240M\n","  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n","                                 Dload  Upload   Total   Spent    Left  Speed\n","100  1149  100  1149    0     0  10258      0 --:--:-- --:--:-- --:--:-- 10258\n","100  689M  100  689M    0     0   208M      0  0:00:03  0:00:03 --:--:--  235M\n","  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n","                                 Dload  Upload   Total   Spent    Left  Speed\n","100  1167  100  1167    0     0  11114      0 --:--:-- --:--:-- --:--:-- 11114\n","100  689M  100  689M    0     0   237M      0  0:00:02  0:00:02 --:--:--  295M\n","  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n","                                 Dload  Upload   Total   Spent    Left  Speed\n","100  1159  100  1159    0     0   2313      0 --:--:-- --:--:-- --:--:--  2313\n","100  689M  100  689M    0     0   225M      0  0:00:03  0:00:03 --:--:--  300M\n","  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n","                                 Dload  Upload   Total   Spent    Left  Speed\n","100  1149  100  1149    0     0  11376      0 --:--:-- --:--:-- --:--:-- 11490\n","100  689M  100  689M    0     0   246M      0  0:00:02  0:00:02 --:--:--  285M\n","  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n","                                 Dload  Upload   Total   Spent    Left  Speed\n","100  1145  100  1145    0     0  10904      0 --:--:-- --:--:-- --:--:-- 10904\n","100  293M  100  293M    0     0   212M      0  0:00:01  0:00:01 --:--:--  242M\n","  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n","                                 Dload  Upload   Total   Spent    Left  Speed\n","100  1151  100  1151    0     0  11174      0 --:--:-- --:--:-- --:--:-- 11174\n","100 71.3M  100 71.3M    0     0   106M      0 --:--:-- --:--:-- --:--:--  106M\n","  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n","                                 Dload  Upload   Total   Spent    Left  Speed\n","100  1149  100  1149    0     0  11490      0 --:--:-- --:--:-- --:--:-- 11376\n","100  295M  100  295M    0     0   170M      0  0:00:01  0:00:01 --:--:--  238M\n","  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n","                                 Dload  Upload   Total   Spent    Left  Speed\n","100  1153  100  1153    0     0  10577      0 --:--:-- --:--:-- --:--:-- 10577\n","100  295M  100  295M    0     0   176M      0  0:00:01  0:00:01 --:--:--  193M\n","  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n","                                 Dload  Upload   Total   Spent    Left  Speed\n","100  1161  100  1161    0     0  11727      0 --:--:-- --:--:-- --:--:-- 11727\n","100  295M  100  295M    0     0   166M      0  0:00:01  0:00:01 --:--:--  199M\n","  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n","                                 Dload  Upload   Total   Spent    Left  Speed\n","100  1145  100  1145    0     0  10601      0 --:--:-- --:--:-- --:--:-- 10601\n","100  295M  100  295M    0     0   184M      0  0:00:01  0:00:01 --:--:--  241M\n","  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n","                                 Dload  Upload   Total   Spent    Left  Speed\n","100  1153  100  1153    0     0  10775      0 --:--:-- --:--:-- --:--:-- 10775\n","100  293M  100  293M    0     0   219M      0  0:00:01  0:00:01 --:--:--  234M\n","  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n","                                 Dload  Upload   Total   Spent    Left  Speed\n","100  1149  100  1149    0     0  10638      0 --:--:-- --:--:-- --:--:-- 10738\n","100  147M  100  147M    0     0   149M      0 --:--:-- --:--:-- --:--:--  174M\n","/content/stable-diffusion-webui\n","D\tCODEOWNERS\n","D\tLICENSE.txt\n","D\tREADME.md\n","D\tembeddings/Place Textual Inversion embeddings here.txt\n","D\tenvironment-wsl2.yaml\n","D\tlaunch.py\n","D\trequirements.txt\n","D\trequirements_versions.txt\n","D\tscreenshot.png\n","D\tscript.js\n","D\tstyle.css\n","D\twebui-macos-env.sh\n","D\twebui-user.bat\n","D\twebui-user.sh\n","D\twebui.bat\n","D\twebui.py\n","D\twebui.sh\n","HEAD is now at 0cc0ee1b Merge pull request #7945 from w-e-w/fix-image-downscale\n","Cloning into 'embeddings'...\n","remote: Enumerating objects: 44, done.\u001b[K\n","remote: Counting objects: 100% (25/25), done.\u001b[K\n","remote: Compressing objects: 100% (25/25), done.\u001b[K\n","remote: Total 44 (delta 8), reused 0 (delta 0), pack-reused 19\u001b[K\n","Unpacking objects: 100% (44/44), 5.96 KiB | 763.00 KiB/s, done.\n","/content/stable-diffusion-webui/models\n","fatal: destination path 'ESRGAN' already exists and is not an empty directory.\n","/content/stable-diffusion-webui\n","python3: can't open file '/content/stable-diffusion-webui/launch.py': [Errno 2] No such file or directory\n"]}],"source":["!curl -Lo memfix.zip https://github.com/nolanaatama/sd-webui/raw/main/memfix.zip\n","!unzip /content/memfix.zip\n","!apt install -qq libunwind8-dev\n","!dpkg -i *.deb\n","%env LD_PRELOAD=libtcmalloc.so\n","!rm *\n","!pip install --upgrade fastapi==0.90.1\n","!pip install torch==1.13.1+cu116 torchvision==0.14.1+cu116 torchaudio==0.13.1 torchtext==0.14.1 torchdata==0.5.1 --extra-index-url https://download.pytorch.org/whl/cu116 -U\n","!git clone https://github.com/AUTOMATIC1111/stable-diffusion-webui\n","!git clone https://github.com/nolanaatama/sd-webui-tunnels /content/stable-diffusion-webui/extensions/sd-webui-tunnels\n","!git clone https://github.com/Mikubill/sd-webui-controlnet /content/stable-diffusion-webui/extensions/sd-webui-controlnet\n","!git clone https://github.com/hnmr293/posex /content/stable-diffusion-webui/extensions/posex\n","!git clone https://github.com/yfszzx/stable-diffusion-webui-images-browser /content/stable-diffusion-webui/extensions/stable-diffusion-webui-images-browser\n","# Model Code\n","!curl -Lo /content/stable-diffusion-webui/models/Stable-diffusion/chilled_re-generic.safetensors https://huggingface.co/nolanaatama/chlldrgnrc/resolve/main/chilled_re-generic.safetensors\n","# ControlNet\n","!curl -Lo /content/stable-diffusion-webui/extensions/sd-webui-controlnet/models/control_canny.safetensors https://huggingface.co/webui/ControlNet-modules-safetensors/resolve/main/control_canny-fp16.safetensors\n","!curl -Lo /content/stable-diffusion-webui/extensions/sd-webui-controlnet/models/control_depth.safetensors https://huggingface.co/webui/ControlNet-modules-safetensors/resolve/main/control_depth-fp16.safetensors\n","!curl -Lo /content/stable-diffusion-webui/extensions/sd-webui-controlnet/models/control_hed-fp16.safetensors https://huggingface.co/webui/ControlNet-modules-safetensors/resolve/main/control_hed-fp16.safetensors\n","!curl -Lo /content/stable-diffusion-webui/extensions/sd-webui-controlnet/models/control_mlsd-fp16.safetensors https://huggingface.co/webui/ControlNet-modules-safetensors/resolve/main/control_mlsd-fp16.safetensors\n","!curl -Lo /content/stable-diffusion-webui/extensions/sd-webui-controlnet/models/control_normal-fp16.safetensors https://huggingface.co/webui/ControlNet-modules-safetensors/resolve/main/control_normal-fp16.safetensors\n","!curl -Lo /content/stable-diffusion-webui/extensions/sd-webui-controlnet/models/control_openpose-fp16.safetensors https://huggingface.co/webui/ControlNet-modules-safetensors/resolve/main/control_openpose-fp16.safetensors\n","!curl -Lo /content/stable-diffusion-webui/extensions/sd-webui-controlnet/models/control_scribble-fp16.safetensors https://huggingface.co/webui/ControlNet-modules-safetensors/resolve/main/control_scribble-fp16.safetensors\n","!curl -Lo /content/stable-diffusion-webui/extensions/sd-webui-controlnet/models/control_seg-fp16.safetensors https://huggingface.co/webui/ControlNet-modules-safetensors/resolve/main/control_seg-fp16.safetensors\n","!curl -Lo /content/stable-diffusion-webui/extensions/sd-webui-controlnet/models/t2iadapter_canny_sd14v1.pth https://huggingface.co/TencentARC/T2I-Adapter/resolve/main/models/t2iadapter_canny_sd14v1.pth\n","!curl -Lo /content/stable-diffusion-webui/extensions/sd-webui-controlnet/models/t2iadapter_color_sd14v1.pth https://huggingface.co/TencentARC/T2I-Adapter/resolve/main/models/t2iadapter_color_sd14v1.pth\n","!curl -Lo /content/stable-diffusion-webui/extensions/sd-webui-controlnet/models/t2iadapter_depth_sd14v1.pth https://huggingface.co/TencentARC/T2I-Adapter/resolve/main/models/t2iadapter_depth_sd14v1.pth\n","!curl -Lo /content/stable-diffusion-webui/extensions/sd-webui-controlnet/models/t2iadapter_keypose_sd14v1.pth https://huggingface.co/TencentARC/T2I-Adapter/resolve/main/models/t2iadapter_keypose_sd14v1.pth\n","!curl -Lo /content/stable-diffusion-webui/extensions/sd-webui-controlnet/models/t2iadapter_openpose_sd14v1.pth https://huggingface.co/TencentARC/T2I-Adapter/resolve/main/models/t2iadapter_openpose_sd14v1.pth\n","!curl -Lo /content/stable-diffusion-webui/extensions/sd-webui-controlnet/models/t2iadapter_seg_sd14v1.pth https://huggingface.co/TencentARC/T2I-Adapter/resolve/main/models/t2iadapter_seg_sd14v1.pth\n","!curl -Lo /content/stable-diffusion-webui/extensions/sd-webui-controlnet/models/t2iadapter_sketch_sd14v1.pth https://huggingface.co/TencentARC/T2I-Adapter/resolve/main/models/t2iadapter_sketch_sd14v1.pth\n","!curl -Lo /content/stable-diffusion-webui/extensions/sd-webui-controlnet/models/t2iadapter_style_sd14v1.pth https://huggingface.co/TencentARC/T2I-Adapter/resolve/main/models/t2iadapter_style_sd14v1.pth\n","import shutil\n","shutil.rmtree('/content/stable-diffusion-webui/embeddings')\n","%cd /content/stable-diffusion-webui\n","!git checkout 0cc0ee1\n","!git clone https://huggingface.co/nolanaatama/embeddings\n","%cd /content/stable-diffusion-webui/models\n","!git clone https://huggingface.co/nolanaatama/ESRGAN\n","%cd /content/stable-diffusion-webui\n","# Web UI tunnel\n","!COMMANDLINE_ARGS=\"--share --disable-safe-unpickle --no-half-vae --xformers --reinstall-xformers --enable-insecure-extension- --gradio-queue --remotemoe\" REQS_FILE=\"requirements.txt\" python launch.py\n","# If remotemoe failed to start, change '--remotemoe' to '--cloudflared' on the COMMANDLINE_ARGS line above to use cloudflare tunnel"]},{"cell_type":"markdown","source":["## (OPTIONAL) LoRAs"],"metadata":{"id":"0DwYF_aLUXKy"}},{"cell_type":"markdown","source":["### 1. After the gradio link show up, stop the first cell & clear the code output👆"],"metadata":{"id":"JUtPlg328avv"}},{"cell_type":"markdown","source":["### 2. Load the LoRA & launch the web ui"],"metadata":{"id":"xy_WyDzNUgd2"}},{"cell_type":"code","source":["# Copy the LoRA code from other LoRA setup (download the setup file after editing the LoRA code cell to avoid repeat input for next session)\n","# How-to download the setup file: Click 'File' menu -> 'Download' -> 'Download .ipynb'\n","# Load LoRA from Google Drive: https://youtu.be/G1QZfAPUMaM\n","\n","# Japanese Doll Likeness\n","!curl -Lo /content/stable-diffusion-webui/models/Lora/japaneseDollLikeness_v10.safetensors https://huggingface.co/nolanaatama/jdllora/resolve/main/jdllora.safetensors\n","\n","# Korean Doll Likeness\n","!curl -Lo /content/stable-diffusion-webui/models/Lora/koreanDollLikeness_v15.safetensors https://huggingface.co/nolanaatama/kdllora/resolve/main/kdllorav15.safetensors\n","\n","# Taiwan Doll Likeness\n","!curl -Lo /content/stable-diffusion-webui/models/Lora/taiwanDollLikeness_v10.safetensors https://huggingface.co/nolanaatama/tdllora/resolve/main/tdllora.safetensors\n","\n","# ...\n","\n","# Web UI tunnel\n","!COMMANDLINE_ARGS=\"--share --disable-safe-unpickle --no-half-vae --xformers --reinstall-xformers --enable-insecure-extension- --gradio-queue --remotemoe\" REQS_FILE=\"requirements.txt\" python launch.py\n","# If remotemoe failed to start, change '--remotemoe' to '--cloudflared' on the COMMANDLINE_ARGS line above to use cloudflare tunnel"],"metadata":{"id":"3EOPSiOgUs4z"},"execution_count":null,"outputs":[]},{"cell_type":"markdown","metadata":{"id":"fhwIXzcgfkoR"},"source":["# 📚 GitHub for more: [_@nolanaatama_](https://github.com/nolanaatama)\n","# 📦 Repo: [Github](https://github.com/nolanaatama/sd-1click-colab)"]}],"metadata":{"accelerator":"GPU","colab":{"provenance":[{"file_id":"17Ls0C6XGW9wjrFdv8XbVSDr4YX6hir6O","timestamp":1681828179857}],"gpuType":"T4"},"gpuClass":"standard","kernelspec":{"display_name":"Python 3","name":"python3"},"language_info":{"name":"python"}},"nbformat":4,"nbformat_minor":0}